# ToDo API (Матрица Эйзенхауэра) — v3.0.0

Учебный проект по изучению **FastAPI**, выполненный студентом группы **БСБО-12-22** Арзуманянцем М. Э.

## Описание
Сервис предоставляет API для управления списком задач, классифицированных по методу Эйзенхауэра (важность/срочность). 
**Версия 2.0.0:** Переход на асинхронную работу с базой данных **PostgreSQL (Supabase)** с использованием **SQLAlchemy 2.0**.
**Версия 3.0.0:** Добавлены аутентификация (JWT), роли пользователей (USER/ADMIN) и разграничение доступа: USER работает только со своими задачами, ADMIN видит все.

## Основные эндпоинты (v3)
Все эндпоинты API имеют префикс `/api/v3`.

* `GET /` — информация об API и версии.
* `GET /health` — проверка статуса API и подключения к базе данных.
* `POST /api/v3/auth/register` — регистрация пользователя.
* `POST /api/v3/auth/login` — вход и получение JWT токена (OAuth2 Password).
* `GET /api/v3/auth/me` — информация о текущем пользователе (требует Bearer token).
* `PATCH /api/v3/auth/change-password` — смена пароля (требует Bearer token).
* `GET /api/v3/tasks` — список задач (USER — только свои, ADMIN — все).
* `GET /api/v3/tasks/today` — задачи, дедлайн которых истекает сегодня (USER — только свои, ADMIN — все).
* `GET /api/v3/tasks/{id}` — задача по ID (с учетом прав доступа).
* `GET /api/v3/tasks/search?q=...` — поиск задач (минимум 2 символа, с учетом прав доступа).
* `GET /api/v3/tasks/status/{status}` — фильтрация по статусу (`completed` / `pending`, с учетом прав доступа).
* `GET /api/v3/tasks/quadrant/{quadrant}` — фильтрация по квадранту (`Q1`-`Q4`, с учетом прав доступа).
* `POST /api/v3/tasks/` — создание новой задачи (привязывается к текущему пользователю).
* `PUT /api/v3/tasks/{id}` — обновление задачи (с учетом прав доступа).
* `PATCH /api/v3/tasks/{id}/complete` — отметка задачи как выполненной (с учетом прав доступа).
* `DELETE /api/v3/tasks/{id}` — удаление задачи (с учетом прав доступа).
* `GET /api/v3/stats/` — статистика задач (USER — только свои, ADMIN — все).
* `GET /api/v3/stats/deadlines` — статистика по дедлайнам для невыполненных задач (USER — только свои, ADMIN — все).
* `GET /api/v3/admin/users` — список всех пользователей и количество их задач (только ADMIN).

## Запуск проекта
1. Настройте подключение к БД в файле `.env`:
   ```text
   DATABASE_URL=postgresql+asyncpg://user:pass@host:port/dbname
   SECRET_KEY=your-secret-key
   ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Запустите сервер:
   ```bash
   uvicorn main:app --reload
   ```

Документация Swagger доступна по адресу: `/docs`
